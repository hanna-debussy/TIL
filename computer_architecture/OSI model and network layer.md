# OSI 7계층

![img](https://velog.velcdn.com/images%2Fdyllis%2Fpost%2F7a6679e2-26e0-4d3e-b792-c866b9012226%2F%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C.png)

Open Systems Interconnection model. **네트워크 통신이 일어나는 과정을 7단계로 나눈 것을 OSI 7계층이라고 한다.**

데이터를 보낼 때에는 상위 계층(7계층) &rarr; 하위 계층(1계층) 순으로 데이터가 전달되고, 데이터를 받을 때에는 반대로 하위 계층(1계층) &rarr; 상위 계층(7계층) 순으로 데이터를 전달받게 된다. 전자를 캡슐화, 후자를 역캡슐화라고 한다. 일종의 마트료시카처럼 캡슐화는 작은 인형을 큰 인형 안에 계속 넣는 거, 역캡슐화는 반대로 큰 인형을 하나씩 열어서 꺼내는 거라고 생각하면 된다.

 

## 7개나?

계층을 나눈 이유는 이렇게 과정을 단계별로 파악했을 때 장점이 많기 때문이다. 한 눈에 이해하기도 쉽고, 어디서 이상이 생겼는지도 빠르게 체크할 수 있기 때문에 **고치기가 쉽다**.

각 계층은 하위 계층을 사용하고, 현 계층의 기능을 포함해서 상위 계층에 제공한다. 즉 최상위 계층만 보면 그 아래 계층들을 모두 볼 수 있다는 뜻.



## 간단한 7형제 소개

### 1 물리계층
말 그대로 하드웨어 전송 기술로 이루어져 있다. 0과 1의 비트의 기계적인 신호를 물리적인 장치로 쏘고 받는 계층이다. 그냥 신호만 주고 받기 때문에 데이터의 종류나 오류 제어에 관여하지 않는다.

전송 단위: bit
프로토콜: RS-232C 등
장비: 허브, 통신 케이블, 리피터 등



### 2 데이터 링크 계층

오류 제어를 하는 곳이 여기다. 두 개의 개방 시스템들 간의 효율적이고 신뢰성 있는 정보 전송을 위해 오류의 검출과 회복을 담당한다. 또한 송수신 사이의 속도 차이를 해결하기 위한 흐름 제어 기능도 여기서 처리하고, 프레임의 시작과 끝을 구분하기 위한 프레임 동기화 기능도 한다.

전송 단위: Frame
프로토콜: 이더넷, MAC, PPP 등
장비: 스위치, 브릿지 등



### 3 네트워크 계층

우리에게 친숙한 IP주소를 제공하는 계층이 여기다. 대표적으로 노드들을 거칠 때마다 라우팅해주는(경로를 찾아주는) 역할이다. 2 데이터 링크 계층이 노드와 노드 사이를 담당한다면 여기는 시작점부터 목적지까지 전체적으로 전달되도록 하는 역할을 담당한다.
다양한 길이의 데이터를 네트워크들을 통해 전달하고, 그 과정에서 각 계층이 요구하는 서비스 품질을 제공하기 위한 기능적, 절차적 수단을 제공한다.

전송단위 : 패킷(Packet)
프로토콜 : IP, ICMP 등
장비 : 라우터, L3 스위치



### 4 전송 계층

통신을 활성화하기 위한 계층. 포트를 열어서(주소를 설정해서) 응용 프로그램들이 전송을 할 수 있게 만든다. 데이터가 왔다면 패킷의 전송이 유효한지 체크하고 전송에 실패한 패킷을 다시 보내는 등의 신뢰성 있는 통신을 보장해서 데이터들을 통합한 다음 5계층으로 전달한다.

전송단위 : 세그먼트(Segment)
프로토콜 : TCP, UDP 등
장비 : 게이트웨이, L4 스위치



### 5 세션 계층

여기서부터 데이터를 만들어내는 계층들이다. 양 끝단의 응용 프로세스가 통신을 관리하는 방법을 제공한다. 통신 연결이 손실되면 연결 복구 시도를 하고, 연결 시도 중 장시간 연결이 되지 않으면 프로토콜의 연결을 닫고 다시 연결을 시도한다. 

프로토콜 : NetBIOS, SSH, TLS



### 6 표현 계층

7 응용 계층과 5 세션 계층 사이에 왔다갔다 하는 데이터들을 보내기 전에 각 계층의 통신에 적당한 형태로 변환하는 역할을 한다(코드 간 번역). 코드 변환, 구문 검색, 데이터 압축 및 암호화 등의 기능이 있다.

프로토콜 : JPG, MPEG, SMB, AFP



### 7 응용 계층

응용 프로세스와 직접 관계해서 일반적인 응용 서비스를 수행하는 계층이다. 최종 사용자에게 가장 가까운, 정말 우리가 사용하는 사용자 인터페이스를 제공하는 프로그램들을 일컫는다. 

프로토콜 : DNS, FTP, HTTP



## 2계층, 데이터 링크

1계층인 물리 계층에서는 허브를 통해 무지성으로 데이터를 보낸다. 내가 같은 네트워크 상의 저 컴퓨터를 콕 집어서 데이터를 보내고 싶어도 허브에 연결되어있는 모든 컴퓨터에게 아무런 검증 없이 보내진다. 이러한 방식을 더 다듬기 위해 2계층, 데이터 링크 계층이 존재한다.



### 프로토콜: 이더넷

이더넷Ethernet은 랜Local Area Network에서 적용되는 프로토콜이다. 



#### MAC 주소

이더넷은 MAC(Media Access Control) 주소라는 것을 정의한다. 랜 카드가 제조될 때 붙여지기 때문에 물리 주소라고도 불리며, 모든 랜카드의 MAC 주소는 다르다. 겹칠 수가 없다. 일종의 주민등록번호인 셈이다.

MAC 주소는 48bit의 숫자로 이루어져있다. 앞의 24bit는 랜카드 제조사 번호, 뒤의 24bit는 해당 랜카드 제조사가 랜카드에 할당한 고유 번호다.



#### Frame

네트워크 케이블을 통해 전송되는 단위를 우리는 프레임이라 부른다. 프레임은 이더넷 헤더, 전송하고자 하는 데이터, 그리고 FCS로 구성되어 있다.
데이터를 7 &rarr; 1로 전송하면서 캡슐화 할 때마다 각 계층에서 인식할 수 있는 헤더를 붙이게 된다. 1계층이 가장 헤더가 많은 셈인데, 2계층에서는 이더넷 헤더와 트레일러(FCS)가 붙는다.

##### 이더넷 헤더

이더넷 헤더는 목적지 MAC 주소 6byte, 출발지 MAC 주소 6byte, 유형(프로토콜) 2byte로 이루어져 있다. 목적지가 적혀있으니 이상한 곳으로 간다 해도 랜카드들이 자기 주민번호가 아니면 정보를 파기해서 보안 이슈도 어느 정도 해결하게 하는 헤더다.

##### FCS

트레일러라고도 부르는데, 데이터 전송 중 오류가 발생하는지 확인하는 용도다.



### 스위치

2계층에서 데이터들은 위의 프로토콜로 움직이게 되는데, 그 장비가 바로 스위치이다. 



#### 허브가 어때서?

* 반이중 통신: 데이터의 송수신을 번갈아가면서 함
* 전이중 통신: 데이터의 송수신을 동시에 함

허브는 **반이중 통신**을 사용한다. 1차선 도로라고 생각하면 된다.
그런데 만약 서로 다른 컴퓨터가 동시에 데이터를 전송하려고 하면? 1차선에 차량 두 대가 동시에 끼어든다면? 충돌이 일어날 수 있다. 그래서 어느 한 쪽이 케이블에 빈 자리가 날 때까지(데이터가 전송될 때까지) 기다려야 할 것이다. 이러한 방식을 CSMA/CD라고 한다.

하지만? 스위치는 **전이중 통신**을 사용한다. 송신과 수신에 쓰이는 선이 나뉘어져있기 때문이다. 그러므로 CSMA/CD 매커니즘이 필요없어진다. (실제로 현재 CSMA/CD는 거의 쓰이지 않는다.)



허브는 가지지 못 한 스위치의 특징으로는 'MAC 주소 테이블'이 존재한다는 점이다. 스위치의 포트 번호와 그 포트에 연결되어 있는 컴퓨터의 각 MAC 주소가 등록되어 있는 데이터베이스다. 



#### 어떻게 동작하나요?

1. 새로 산 스위치에 컴퓨터들을 연결했다. 우리는 이제 컴퓨터 A에서 컴퓨터 D로 데이터를 전송하려고 한다. 그때 데이터는 스위치를 거치게 되는데, 이때 새 MAC 주소 테이블에 A의 MAC 주소가 찍힐 것이다.
2. 컴퓨터 D를 찾으려고 하니 새 스위치라서 MAC 주소 테이블에 D의 주소가 없다. 이럴 때 스위치가 하는 것이 바로 **플러딩Flooding**이다. 출발지를 제외한 모든 컴퓨터에 데이터를 전송해본다. 그러면 목적지 MAC 주소와 다른 컴퓨터들은 데이터를 파기할 것이고, 컴퓨터 D가 데이터를 가져가면서 D의 주소가 이거구나 , 하고 MAC 주소 테이블에 이제 D의 MAC 주소가 찍힌다.
3. 이제 우리의 스위치는 A와 D의 주소를 안다. 다음에 A에서 D로 보낼 때에는 데이터를 필터링하여 D에게만 데이터를 전송할 것이다. 이게 데이터 막 뿌리는 허브와의 차이점이다.



### ARP(Address Resolution Protocol)

위에서부터 내려오는 데이터는 3계층에서 IP주소는 알아도 2계층에 왔을 때 MAC 주소를 모른다. 그래서 나오는 게 ARP라고 할 수 있다.

ARP는 목적지 컴퓨터의 IP 주소를 활용해 MAC 주소를 찾기 위한 프로토콜이다. 목적지의 MAC 주소를 모른다면 이를 알아내기 위해 IP주소를 브로드캐스팅(해당 네트워크 상의 모든 컴퓨터에 요청하는 것) 하는데, 이를 ARP 요청이라고 한다. 그 IP 주소에 해당하는 컴퓨터가 ARP 응답을 주면, 이를 통해 알아내는 것이다.







## 참조

https://velog.io/@dyllis/OSI-7%EA%B3%84%EC%B8%B5-%EC%A0%95%EB%A6%AC

https://onecoin-life.com/19

https://madplay.github.io/post/network-osi-7-layer

https://velog.io/@jakeseo_me/OSI-7%EA%B3%84%EC%B8%B5-%EC%8B%9C%EB%A6%AC%EC%A6%88-2-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A7%81%ED%81%AC-%EA%B3%84%EC%B8%B5

https://losskatsu.github.io/os-kernel/network-basic03/#
