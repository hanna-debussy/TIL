# 파일 시스템

## 파일 시스템...?

파일 시스템이란 더 나은 저장, 검색을 위해서 논리적으로 어디에 위치시켜야 하는지에 대한 기법을 말한다. 

메모리 공간이 증가함에 따라 파일의 수도 늘어나서, 별도의 관리 시스템이 필요하게 되었다. 그래서 태어난 게 파일 시스템이다. 비유하자면 널브러진 파일들을 이름이나 용도 등으로 검색이 가능하게 캐비넷에 정리해서 저장하도록 하는 거다. 



파일 시스템은 **계층적 디렉토리 구조**를 가지고, **디스크 파티션 별로 하나씩 둘** 수 있다. 그래서 용도에 맞게 파일 시스템을 선택하면 된다. 파일 시스템의 종류에는 FAT(Windows), NTFS(Windows), ext(Linux), HFS+(Mac OS) 등등 굉장히 다양하다.



### 개발 목적 / 역할 

1. 파일을 빨리 가져올 수 있으니 하드 디스크와 메인 메모리 간의 속도 차를 줄일 수 있고, 
2. 파일 관리를 통해 하드 디스크 용량도 효율적으로 이용이 가능하다.
3. 또한 파일이 의도한 정보만 포함한다는 파일 무결성을 지킬 수도 있다.



### 구조

* 데이터 영역
  : 실제 파일의 데이터

* 메타 영역
  : 데이터 영역에 기록된 파일의 이름, 위치, 크기, 시간 정보, 삭제 유무 등의 파일 정보



### 접근 방법

#### 순차 접근 Sequential Access

파일의 정보가 레코드 순서대로 처리된다. 카세트테이프를 사용하는 방식과 동일하다. 현재 위치에서 읽거나 쓰면 offset이 자동으로 증가하고, 뒤로 돌아가기 위해서는 되감기가 필요하다.



#### 직접 접근 Random Access

파일의 레코드를 임의의 순서로 접근할 수 있다. LP 판을 사용하는 방식과 동일하다. 읽기나 쓰기의 순서에 제약이 없다.



#### 색인 접근 Index Access

파일의 레코드를 찾기 위해 색인을 먼저 찾아 대응되는 포인터를 얻는다. 그 다음 파일에 직접 접근해서 원하는 데이터를 얻을 수 있다. 그렇기 때문에 크기가 큰 파일에서 유용하다.



### 디렉터리

디렉터리는 파일의 메타 데이터 중 일부를 보관하고 있는 파일이다. 디렉터리를 통해서 우리는 파일 생성 / 삭제 / 검색, 디렉터리 나열, 파일 재명명, 파일 시스템 순회 등을 할 수 있다.

디렉터리의 논리적 구조를 정의하는 데에는 여러 방법들이 있다.



#### 1단계 디렉터리 Single-Level

![img](https://blog.kakaocdn.net/dn/bbk9x6/btrgpwxekSY/LC5Y2BhsAypMTbdWfMToRK/img.png)

모든 파일들이 디렉터리 밑에 존재하는 구조다. 사용자가 달라도 같은 이름을 쓰면 안 되고 파일들 서로 간에 고유한 이름을 가져야 한다. 

가장 직관적이지만, 파일이 많아지거나 다수의 사용자가 사용하는 시스템에서는 제약이 클 수밖에 없다.



#### 2단계 디렉터리 Two-Level

![img](https://blog.kakaocdn.net/dn/lLfBK/btrgxCCjMG6/eRQ02qksvFI7JIGQZ2KZdK/img.png)

1단계와 달리 각 사용자마다 별도의 디렉터리를 갖는 형태이다.

* MFD (Master File Directory)
  : 사용자의 이름과 계정 번호로 구분되는 디렉터리. 각 엔트리는 그 사용자의 디렉터리를 가리킨다.
* UFD (User File Directory)
  : 해당 사용자의 파일 디렉터리. 



사용자가 다르다면 같은 이름의 파일을 가질 수 있고, 효율적인 탐색이 가능하다. 하지만 그룹화가 불가능하고, 다른 사용자의 파일에 접근할 때 어려움이 있다.



#### 트리 구조 디렉터리 Tree-Structured

![img](https://blog.kakaocdn.net/dn/k8pMk/btrgx0JQ4zK/Zw5OniN9knvCQxKTDBJ3P1/img.png)

'사용자가' 자신의 서브 디렉터리를 만들 수 있다. 이렇게 하면 효율적 탐색도, 그룹화도 가능하다.

디렉터리도 일종의 파일이기 때문에 일반 파일과 구분하기 위해 구분 비트를 사용하여 일반 파일이면 0, 디렉터리면 1로 구분한다.



#### 비순환 그래프 디렉터리 Acyclic-Graph

![img](https://blog.kakaocdn.net/dn/c1f9RF/btrgvUpXqh3/IDPjd6TkDgHQYuURltRmKk/img.png)

디렉터리들이 서브 디렉터리들과 파일을 공유할 수 있다. 

하지만 파일을 무작정 삭제하면 현재 파일을 가리키는 포인터는 대상을 잃게 되는 문제가 생기므로 파일에 참조 계수를 두어서, 그 참조 계수가 0이 되면 파일을 참조하는 링크가 존재하지 않는다는 의미이므로 그때 파일을 삭제할 수 있도록 한다.



#### 일반 그래프 구조 디렉터리 General Graph

![img](https://blog.kakaocdn.net/dn/bTWgpK/btrgC55TQPU/eFeUEtjgM8pbkyRsq4eX3K/img.png)

순환을 허용하는 그래프 구조이다.

다만 순환이 허용되면 무한 루프에 빠질 수 있기 때문에 하위 디렉터리가 아닌 파일에 대한 링크만 허용하거나, garbage collection을 통해 전체 파일 시스템을 순회하고, 접근 가능한 것들을 표시한다.





## 여러 파일 시스템

https://daesiker.tistory.com/36 참고



## 면접 예상 질문

파일 시스템의 역할

파일 시스템의 종류



## 참고

https://rebro.kr/181

https://security-nanglam.tistory.com/228

https://daesiker.tistory.com/36