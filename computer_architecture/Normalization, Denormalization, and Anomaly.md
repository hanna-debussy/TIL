# Normalization, Denormalization

## Normalization

### 정규화란?

데이터베이스 정규화란 데이터베이스의 설계를 재구성하는 테크닉 중 하나로, 테이블 간 **중복된 데이터를 최소화하는 프로세스**를 말한다.



정규화를 하면 

1. 무결성(Integrity)를 유지할 수 있으며,
2. 불필요한 데이터(data redundancy)를 제거하여 DB의 저장 용량을 줄이고 저장 공간을 더 효율적으로 사용할 수 있다.
3. 또한 삽입/갱신/삭제 시 발생할 수 있는 각종 이상 현상(**Anamolies**)들을 방지할 수 있다.
4. 그래서 이 모든 것들을 통해 데이터를 '논리적으로' 저장할 수 있게 된다.



### Anomaly?

DB에서 일어나는 anomalies에는 세 가지가 있다.

| 이름   | 성별 | 강의코드 | 강의명    | github        |
| ------ | ---- | -------- | --------- | ------------- |
| 김무종 | 남   | cs01     | C언어     | pugcute       |
| 김혜림 | 여   | cs02     | vue.js    | hrookim       |
| 마주리 | 여   | cs03     | django    | joorii        |
| 김혜림 | 여   | cs04     | algorithm | hrookim       |
| 장한나 | 여   | cs05     | spring    | hanna-debussy |

이런 테이블이 있다고 하자.



#### 삽입 이상

: 자료를 삽입할 때 의도하지 않은(불필요한) 자료까지 삽입해야만 테이블에 자료 추가가 가능한 상황.

아직 강의를 수강하지 않은 전학생을 삽입할 경우 강의코드와 강의명 속성에 null이 들어가야하는 문제가 생긴다.



#### 갱신 이상

: 중복된 데이터 중 일부만 수정되어 데이터 모순이 일어나는 상황.

두 번째 레코드인 혜림 님의 github을 수정하는 경우 두 번째, 네 번째 레코드는 같은 사용자임에도 불구하고 github이 다르게 저장된다.



#### 삭제 이상

: 어떤 정보를 삭제하면, 의도하지 않은 다른 정보까지 삭제되는 상황.

만약 강의코드가 'cs03'인 django 강의가 폐강되어 삭제한다면, 주리 님의 데이터 전체까지 삭제되어 버린다.



그러므로 이러한 anomalies를 막고 효과적인 연산을 위해서라도 데이터 정규화가 필요한 것이다.



### 정규화의 단계

정규화에는 테이블을 어떻게 분해하는지에 따라 여섯 단계가 있다. 모든 단계는 이전 단계를 만족하고 플러스 알파로 다른 조건을 만족하여야 한다.



![](https://images.velog.io/images/bsjp400/post/140f510e-26ed-4807-a517-bc0b9a902c69/image.png)



#### 제1 정규화(1st Normal Form, 1NF)

| 이름   | 성별 | 학번       |
| ------ | ---- | ---------- |
| 김무종 | 남   | 1234, 5678 |
| 김혜림 | 여   | 1580       |
| 마주리 | 여   | 9876       |

제1정규화는 보통 '**도메인이 모두 원자값**'이어야 한다고 축약된다. 

여기서 '원자값(Atomic Value)'이라는 건 하나의 값을 가진다는 걸 뜻한다. 표에서는 무종님의 학번이 지금 두 개이므로 제1정규화를 위반했다. 마찬가지로 만약 학번 컬럼이 학번1, 학번2로 나뉘어져 있다면 이 또한 제1정규화를 위반한 셈이다. 또한 기본키를 이용하여 고유 식별이 가능해야 한다는 조건도 제1정규화에 포함되어있다.



#### 제2 정규화(2nd Normal Form, 2NF)

제2정규화는 부분 함수적 종속을 제거하여 '**완전 함수적 종속을 만족**'하여야 한다.

> 함수적 종속?
>
> : 특정 속성 X가 다른 속성 Y의 값을 결정할 때, Y는 X에 종속되어있다고 한다. 즉 X가 바뀌면 Y도 바뀌어야 한다는 것.
>
> * x1과 x2가 y를 바꿀 경우 __완전 함수적 종속__이다.
> * x1과 x2 중 하나만으로도 y의 값을 결정할 경우 __부분 함수적 종속__이다.



| 학번 | 학과         | 강의코드 | 성적 | 등록금 |
| ---- | ------------ | -------- | ---- | ------ |
| 1234 | 철학         | cs01     | A+   | 100    |
| 1580 | 시스템생물학 | cs02     | A    | 150    |
| 1580 | 시스템생물학 | cs04     | A+   | 150    |

학번은 학과와 등록금을 정할 수 있고, 학번과 과목코드를 버무리면 성적을 정할 수 있다. 수학처럼 생각하자면 변수가 x(학번)와 y(과목코드) 두 개인 함수인 셈인데, x만으로도 학과와 등록금을 결정할 수 있기 때문에 이 테이블은 부분 함수적 종속이 된다. 

이런 경우엔 보통 학번-학과-등록금 테이블과 학번-과목코드-성적 테이블 두 개로 분리시키는 게 정답이다.



#### 제3 정규화(3rd Normal Form, 3NF)

제3정규화에서는 '**이행 함수 종속을 제거**'한다. 

> 이행 규칙: X&rarr;Y이고 Y&rarr;Z이면 X&rarr;Z이다.

이행규칙에 따르면 Y도 X만의 속성이고 Z도 X만의 속성이 된다. 

| 학번 | 학과       | 등록금 |
| ---- | ---------- | ------ |
| 9876 | 중어중문학 | 110    |

그러면 학번 9876 학생에게 '중어중문학'도, '110'도 그 학생만의 속성이라는 뜻이다. 그런데 만약 중어중문학과의 등록금이 120으로 인상되었다면? 그것과 별개로 등록금 110은 9876 학생만의 것이므로 우리는 따로 110을 120으로 변경해주어야 한다.

이런 경우 학번-학과 테이블과 학과-등록금 테이블로 나누는 것이 제3정규화를 지키는 방법이 되겠다.



#### BCNF(Boyce and Codd Normal Form)

BCNF에서는 '**모든 결정자가 후보키가 되도록**' 만든다.

제3정규화까지 만족해도 하나의 릴레이션에 여러 후보키가 존재할 수 있기 때문에 이로 이한 이상 현상을 해결하기 위해 좀 더 엄격한 제약조건을 Boyce와 Codd가 제시한 것이다.

> 후보키: 각 행을 유일하게 식별할 수 있는 슈퍼키(하나 이상의 속성 집합) 중 최소성을 만족하는 것들.



| 학번 | 강의명 | 교수  | 학점 |
| ---- | ------ | ----- | ---- |
| 1234 | django | Harry | A+   |
| 1580 | vue    | Neo   | A    |
| 9876 | vue    | Neo   | A+   |

위는 한 교수당 하나의 수업만을 맡는다고 가정한 제3정규화가 이루어진 테이블이다. 그런데 제3정규화까지만 오면 아래와 같은 이상 현상이 생긴다.

1. 새로운 교수가 새 과목을 담당한다면 수강생 없이 테이블에 추가할 수 없다.
2. 학생 1234가 django 과목을 취소하면, Harry가 django를 담당한다는 정보도 사라진다.
3. vue 과목에 변경이 생기면 vue 행을 전부 찾아 관련 정보를 일일이 변경시켜주어야 한다.

왜 그럴까? 지금 이 테이블에서는 (학번, 강의명)으로, 또는 (학번, 교수)로 레코드를 특정할 수 있다. 저 두 개가 후보키인 셈이다. 교수 단독으로는 후보키가 될 수 없다. 하지만? 교수가 정해지면 강의명이 정해진다. 그러니까 *교수는 후보키는 아니지만 결정자에 속하게 된다*. 여기서부터 잘못된 거다.

그래서 모든 결정자는 후보키가 되도록 분해해주어야 한다. 교수 단독으로 후보키가 될 수 있어야 한다는 뜻이다. 만약 여기서 테이블을 분해한다면, 학번-교수 테이블, 교수-과목 테이블 이렇게 두 개로 나누어주면 BCNF를 만족하게 될 것이다.



#### 제4 정규화(4th Normal Form, 4NF)

보통 BCNF까지 묻고, 실무적으로 제4, 5정규화는 잘 쓰이지 않는다. 이 둘을 고급 정규화 과정이라고 한다.



제4정규화에서는 '**다(중)치 종속을 제거**'한다. 만약 교수들마다 교과서를 여러 권 쓴다고 하자(=다치 종속). 그러면 제1정규화의 원자값을 가져야 한다는 속성에 의거해서 표는 이렇게 길어질 것이다.

| 강의명 | 교수  | 교재명      |
| ------ | ----- | ----------- |
| django | Harry | 장고짱      |
| django | Harry | 장고 첫걸음 |
| django | Jay   | 장고짱      |
| django | Jay   | 장고 첫걸음 |
| vue    | Neo   | 뷰짱        |
| vue    | Neo   | 뷰 첫걸음   |
| vue    | Neo   | 뷰 마스터   |

개발자라면 지금 매우 불편해야 한다. 중복되는 곳이 너무 많다. 강의명도, 교수도, 교재명도 중복 투성이다. 간단하게 칸수로만 세면 7*3, 21칸이 쓰였다. 그래서 우리는 이하로 나눌 수 있다.

| 강의명 | 교수  |
| ------ | ----- |
| django | Harry |
| django | Jay   |
| vue    | Neo   |

| 강의명 | 교재명      |
| ------ | ----------- |
| django | 장고짱      |
| django | 장고 첫걸음 |
| vue    | 뷰짱        |
| vue    | 뷰 첫걸음   |
| vue    | 뷰 마스터   |

이러한 무손실 분해로 중복을 최소화할 수 있다.



#### 제5 정규화(5th Normal Form, 5NF)

한 릴레이션 안에 존재하는 '**모든 결합 종속(Join Dependency; JD)이 릴레이션의 후보키를 통해서만 성립**'될 때 제5정규화를 만족한다. 한 마디로 이 이상은 릴레이션을 분해해도 의미가 없을 때.



## Denormalization

정규화된 데이터베이스는 중복을 최소화하도록 설계되었기 때문에 아무래도 읽는 데에 시간이 조금 걸린다. 그래서 비정규화된 데이터베이스는 읽는 시간을 최적화하도록 설계된 데이터베이스라고 볼 수 있다.

그래서 간단하게 말하자면 **중복을 허용**한다. 
위에서 학번-학과-등록금을 학번-학과 와 학과-등록금 으로 나눈 케이스를 보자. 언뜻 보면 맞는 말이다. 하지만 학과가 1,000개라면? 10,000개라면? 조인하느라 시간이 너무 많이 소요될 것이다. 이를 위해 그냥 학번-학과-등록금처럼 붙여두자는 거다. 어느 정도의 중복을 감수하면서도 조인 횟수를 줄여 빠른 데이터 조회를 만들겠다는 전략이다.



**장점**

1. 적은 것처럼 조인 횟수를 줄여 빠른 데이터 조회를 꾀한다.
2. 쿼리문을 쓸 때 이 테이블 저 테이블 JOIN시킬 필요가 없다. 그냥 간단하게 그 레코드 조회하면 되니까... 굿.



**단점**

1. 데이터 갱신이나 삽입 비용이 크다
2. 데이터 무결성 훼손으로 인해 이상 현상 발생 가능성이 높아진다
3. 데이터 중복 저장으로 인한 추가 저장 공간 확보가 필요하다



## 예상 문제

* 정규화와 비정규화를 설명하라
* 정규화/비정규화의 장단점



## 참고

https://dev-coco.tistory.com/63

https://nirsa.tistory.com/107

https://velog.io/@bsjp400/Database-DB-%EC%A0%95%EA%B7%9C%ED%99%94-%EB%B9%84%EC%A0%95%EA%B7%9C%ED%99%94%EB%9E%80

https://rebro.kr/160

https://minimax95.tistory.com/50

https://mangkyu.tistory.com/110

https://while-programming.tistory.com/47

https://owlyr.tistory.com/20

https://velog.io/@mindfulness_22/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%95%EA%B7%9C%ED%99%94-VS-%EB%B9%84%EC%A0%95%EA%B7%9C%ED%99%94-%EA%B3%B5%EB%B6%80-%EB%B0%8F-%EC%A0%95%EB%A6%AC